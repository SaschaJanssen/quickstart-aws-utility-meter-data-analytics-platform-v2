== Set up Amazon Managed Grafana
This solution includes a set of Amazon Managed Grafana dashboards. These dashboards use Amazon Athena to query data stored in a data lake and depend on several of the optional datasets for full functionality. Complete the instructions in this section to set up Amazon Managed Grafana.

NOTE: Amazon Managed Grafana supports Security Assertion Markup Language (SAML) and AWS Identity and Access Management (IAM) Identity Center for authentication. If your organization does not have SAML or AWS IAM Identity Center set up, consult your administrator.

=== Create a Grafana workspace
. In the https://console.aws.amazon.com/grafana[Amazon Managed Grafana] console, choose *Create workspace*.

. Enter a *Workspace Name* (for example, `mda_solution`). If desired, enter an optional *Workspace Description*.
. Choose *Next*.
. On the *Configure Settings* page, for *Authentication access*, select *Security Assertion Markup Language (SAML)*.
. For *Permission type*, choose *Service managed*.
. Choose *Next*.
. On the *Service managed permission settings* page, for *IAM permission access settings*, choose *Current account*.
. For *Data sources and notification channels*, select *Amazon Athena*.
. Choose *Next*.
. Choose *Create workspace*.

=== Select SSO users
After creating a workspace, select the single sign-on (SSO) users and groups you want to give access to Amazon Managed Grafana. The Grafana workspace URL is found on the *Outputs* tab of the `aws-utility-meter-data-analytics-platform` stack in the Cloud Formation console.

=== Set up Amazon Athena as a data source in Grafana
Follow the AWS or Grafana docs for setting up Athena as a Data Source in Grafana:

. https://docs.aws.amazon.com/grafana/latest/userguide/AWS-Athena.html:[AWS Docs]
. https://grafana.com/docs/grafana/latest/datasources/add-a-data-source/[Grafana Docs]


=== Import the dashboards into Grafana

. Login into the Grafana console using either SAML or SSO.
. Select the *+* icon and go to import

+
:xrefstyle: short
[#home-import]
.Home Page Import
[link=image/grafanas/grafana-home-import.png]
image::../images/grafana/grafana-home-import.png[HomeImport]

. Either copy in json from the /grafana/<dashboard-name>.json files in the repo or directly upload the json files

+
:xrefstyle: short
[#copy-json]
.Copy JSON
[link=images/grafana/grafana-copy-json.png]
image::../images/grafana/grafana-copy-json.png[CopyJson]

After importing the tables, there may be some updates needed to match the configured data sources and glue database names chosen. If many errors pop up, go in and check the panels' data sources as well as the variables in the dashboard settings menus.
